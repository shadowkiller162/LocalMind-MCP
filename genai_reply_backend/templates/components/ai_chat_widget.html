<!-- AI å°è©±çµ„ä»¶ -->
<div class="card border-primary" id="ai-chat-widget">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h6 class="card-title mb-0">
      <i class="fas fa-robot me-2 text-primary"></i>
      AI åŠ©æ‰‹å°è©±
    </h6>
    <div class="chat-status">
      <span class="badge bg-success">
        <i class="fas fa-circle me-1"></i>å°±ç·’
      </span>
    </div>
  </div>
  
  <!-- å°è©±æ­·å²å€åŸŸ -->
  <div class="card-body p-0">
    <div id="chat-messages" class="chat-messages-container">
      <!-- æ­¡è¿è¨Šæ¯ -->
      <div class="message-wrapper assistant-message">
        <div class="message-avatar">
          <i class="fas fa-robot text-primary"></i>
        </div>
        <div class="message-content">
          <div class="message-bubble">
            <p class="mb-1">ğŸ‘‹ æ‚¨å¥½ï¼æˆ‘æ˜¯ LocalMind-MCP AI åŠ©æ‰‹ã€‚</p>
            <p class="mb-0">æˆ‘å¯ä»¥å”åŠ©æ‚¨ç®¡ç† MCP æœå‹™ã€å›ç­”å•é¡Œæˆ–é€²è¡Œå°è©±æ¸¬è©¦ã€‚è«‹è¼¸å…¥æ‚¨çš„è¨Šæ¯ï¼</p>
          </div>
          <small class="message-time text-muted">ç³»çµ±è¨Šæ¯</small>
        </div>
      </div>
    </div>
  </div>
  
  <!-- è¼¸å…¥å€åŸŸ -->
  <div class="card-footer">
    <form id="chat-form" 
          hx-post="{% url 'mcp_management:chat_send' %}"
          hx-target="#chat-messages"
          hx-swap="beforeend"
          hx-trigger="submit"
          hx-indicator="#send-spinner">
      {% csrf_token %}
      
      <div class="input-group">
        <input type="text" 
               name="message" 
               id="chat-input"
               class="form-control" 
               placeholder="è¼¸å…¥æ‚¨çš„è¨Šæ¯..."
               autocomplete="off"
               required>
        
        <button type="submit" 
                class="btn btn-primary" 
                id="send-button">
          <span id="send-spinner" class="spinner-border spinner-border-sm me-2 d-none"></span>
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
      
      <!-- å¿«é€Ÿå›è¦†é¸é … -->
      <div class="quick-replies mt-2">
        <small class="text-muted me-2">å¿«é€Ÿå›è¦†:</small>
        <button type="button" class="btn btn-outline-secondary btn-sm me-1" 
                onclick="sendQuickMessage('æª¢æŸ¥ MCP ç‹€æ…‹')">
          æª¢æŸ¥ç‹€æ…‹
        </button>
        <button type="button" class="btn btn-outline-secondary btn-sm me-1" 
                onclick="sendQuickMessage('ä»‹ç´¹ LocalMind-MCP åŠŸèƒ½')">
          ç³»çµ±ä»‹ç´¹
        </button>
        <button type="button" class="btn btn-outline-secondary btn-sm" 
                onclick="sendQuickMessage('å¦‚ä½•ä½¿ç”¨ MCP é€£æ¥å™¨ï¼Ÿ')">
          ä½¿ç”¨èªªæ˜
        </button>
      </div>
    </form>
  </div>
</div>

<script>
// AI å°è©±çµ„ä»¶ JavaScript
document.addEventListener('DOMContentLoaded', function() {
    const chatForm = document.getElementById('chat-form');
    const chatInput = document.getElementById('chat-input');
    const chatMessages = document.getElementById('chat-messages');
    
    // è¡¨å–®æäº¤å¾Œæ¸…ç©ºè¼¸å…¥æ¡†
    chatForm.addEventListener('htmx:afterRequest', function(event) {
        if (event.detail.successful) {
            chatInput.value = '';
            chatInput.focus();
            
            // æ»¾å‹•åˆ°æœ€æ–°è¨Šæ¯
            setTimeout(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 100);
        }
    });
    
    // Enter éµæäº¤ (Shift+Enter æ›è¡Œ)
    chatInput.addEventListener('keypress', function(event) {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault();
            chatForm.requestSubmit();
        }
    });
    
    // åˆå§‹èšç„¦
    chatInput.focus();
});

// å¿«é€Ÿè¨Šæ¯ç™¼é€
function sendQuickMessage(message) {
    const chatInput = document.getElementById('chat-input');
    const chatForm = document.getElementById('chat-form');
    
    chatInput.value = message;
    chatForm.requestSubmit();
}

// æ¸…ç©ºå°è©±æ­·å²
function clearChatHistory() {
    const chatMessages = document.getElementById('chat-messages');
    // ä¿ç•™æ­¡è¿è¨Šæ¯
    const welcomeMessage = chatMessages.querySelector('.assistant-message');
    chatMessages.innerHTML = '';
    if (welcomeMessage) {
        chatMessages.appendChild(welcomeMessage);
    }
}
</script>